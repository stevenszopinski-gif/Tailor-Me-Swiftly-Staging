<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-generated Pain Letter that targets the hiring manager's biggest problem and positions you as the solution.">
    <link rel="alternate" type="application/rss+xml" title="TailorMeSwiftly.com Release Notes" href="/feed.xml">
    <title>Pain Letter â€“ TailorMeSwiftly</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“‹</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css?v=6">
    <link rel="stylesheet" href="templates.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7832382680038641" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        .result-page { max-width: 800px; margin: 0 auto; padding: 1.5rem 1.5rem 4rem; }
        .pain-output { background: #fff; color: #111; border-radius: 8px; padding: 2.5rem; min-height: 300px; outline: none; line-height: 1.75; font-family: Georgia, serif; }
        [data-theme="dark"] .pain-output { background: rgba(255,255,255,0.04); color: var(--text-primary); border: 1px solid var(--panel-border); }
        .pain-insight { background: rgba(220,38,38,0.06); border: 1px solid rgba(220,38,38,0.2); border-radius: 12px; padding: 1.25rem; margin-bottom: 1.5rem; }
    </style>
</head>

<body>
    <div class="app-container" style="min-height: auto;">
        <header class="app-header">
            <div class="logo">
                <a href="index.html" style="text-decoration:none;color:inherit;display:flex;align-items:center;gap:0.75rem;">
                    <div class="logo-icon"><i class="fa-solid fa-clipboard"></i></div>
                    <h1>TailorMeSwiftly.com</h1>
                </a>
            </div>
            <div class="header-actions" style="display:flex;gap:1rem;align-items:center;">
                <div id="user-profile" style="display:none;flex-direction:column;align-items:center;gap:0.2rem;position:relative;">
                    <img id="user-avatar" src="" alt="Avatar" style="width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid var(--primary-color);cursor:pointer;" onclick="document.getElementById('avatar-dropdown').classList.toggle('hidden')">
                    <span id="user-greeting" style="font-size:0.7rem;color:var(--text-secondary);white-space:nowrap;"></span>
                    <div id="avatar-dropdown" class="avatar-dropdown hidden">
                        <a href="account.html" class="dropdown-item" style="text-decoration:none;color:inherit;">
                            <i class="fa-solid fa-user-gear"></i> Account
                        </a>
                                                <a href="dashboard.html" class="dropdown-item" style="text-decoration:none;color:inherit;"><i class="fa-solid fa-compass"></i> Dashboard</a>
                        <a href="updates.html" class="dropdown-item" style="text-decoration:none;color:inherit;"><i class="fa-solid fa-bullhorn"></i> Release Notes</a>                        <button class="dropdown-item" id="logout-btn"><i class="fa-solid fa-arrow-right-from-bracket"></i> Sign Out</button>
                    </div>
                </div>
            </div>
        </header>
    </div>

    <div class="result-page">
        <div style="text-align:center;margin-bottom:1.5rem;">
            <a href="results.html" style="color:var(--text-secondary);text-decoration:none;font-size:0.85rem;"><i class="fa-solid fa-arrow-left"></i> Back to Results</a>
        </div>
        <h1 style="text-align:center;font-size:1.6rem;margin:0 0 0.5rem;"><i class="fa-solid fa-crosshairs" style="color:#dc2626;margin-right:0.5rem;"></i>Pain Letter</h1>
        <p style="text-align:center;color:var(--text-secondary);margin-bottom:2rem;">A targeted letter that identifies the hiring manager's problem and positions you as the solution</p>

        <div id="pain-insight"></div>

        <div style="display:flex;gap:0.6rem;justify-content:center;margin-bottom:1.5rem;flex-wrap:wrap;" id="action-bar" style="display:none;">
        </div>

        <div id="pain-output">
            <div style="text-align:center;padding:3rem;"><p style="color:var(--text-secondary);margin-bottom:1.5rem;">Generate a Pain Letter that makes hiring managers think "this person gets it."</p><button class="btn primary-btn" onclick="generatePainLetter()"><i class="fa-solid fa-crosshairs"></i> Generate Pain Letter</button></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.0"></script>
    <script src="auth.js?v=8"></script>
    <script src="error-utils.js"></script>
    <script src="results.js?v=8"></script>
    <script>
        initResultTheme();
        initResultAuth();

        (async function() {
        if (!(await guardToolAccess())) return;
        const outputs = loadOutputs();
        if (!outputs) { showSessionExpired(document.querySelector('.result-page')); return; }

        async function generatePainLetter() {
            const container = document.getElementById('pain-output');
            container.innerHTML = '<p style="color:var(--text-secondary);text-align:center;padding:3rem 0;"><i class="fa-solid fa-spinner fa-spin"></i> Identifying the hiring manager\'s pain points...</p>';

            const systemPrompt = `You are a master of the "Pain Letter" strategy â€” a provocative outreach format that identifies the hiring manager's biggest business problem and positions the candidate as the aspirin.

First analyze the job description to identify the core business problem they're trying to solve by hiring this role. Then write a compelling 3-4 paragraph Pain Letter.

Return EXACTLY this JSON (no markdown, no code fences):
{
    "identifiedPain": "The core business problem/pain point you identified from the JD",
    "painEvidence": "What clues in the JD revealed this pain point",
    "letterHtml": "The complete Pain Letter in clean HTML (p tags, strong tags). Start with a provocative opening about their problem, NOT 'Dear Hiring Manager.' End with a clear call to action.",
    "whyItWorks": "1 sentence on why this letter will get a response"
}`;

            const userPrompt = `Resume:\n${outputs.resumeText}\n\nJob Description:\n${outputs.jobText}\n\nCompany: ${outputs.targetCompany || 'Unknown'}`;

            try {
                const { data, error } = await supabaseClient.functions.invoke('gemini-proxy', {
                    body: {
                        model: 'gemini-3-flash-preview',
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        contents: [{ parts: [{ text: userPrompt }] }],
                        generationConfig: { temperature: 0.8 }
                    }
                });

                if (error) throw new Error(error.message);
                let text = data.candidates[0].content.parts[0].text.trim();
                if (text.startsWith('```')) text = text.replace(/^```\w*\n?/, '').replace(/```$/, '').trim();
                const result = JSON.parse(text);
                renderPainLetter(result);
            } catch (e) {
                container.innerHTML = `<p style="color:var(--error-color);text-align:center;">Failed: ${e.message}<br><button class="btn small-btn primary-btn" style="margin-top:1rem;" onclick="generatePainLetter()"><i class="fa-solid fa-rotate-right"></i> Retry</button></p>`;
            }
        }

        function renderPainLetter(result) {
            document.getElementById('pain-insight').innerHTML = `<div class="pain-insight"><h3 style="margin:0 0 0.5rem;font-size:0.95rem;"><i class="fa-solid fa-crosshairs" style="color:#dc2626;margin-right:0.4rem;"></i> Identified Pain Point</h3><p style="font-size:0.9rem;margin:0 0 0.5rem;">${result.identifiedPain}</p><p style="font-size:0.8rem;color:var(--text-secondary);margin:0;"><strong>Evidence:</strong> ${result.painEvidence}</p></div>`;

            document.getElementById('action-bar').innerHTML = `<button class="btn small-btn ghost-btn" onclick="navigator.clipboard.writeText(document.getElementById('pain-text').innerText);this.innerHTML='<i class=\\'fa-solid fa-check\\'></i> Copied';setTimeout(()=>this.innerHTML='<i class=\\'fa-regular fa-copy\\'></i> Copy',1500)"><i class="fa-regular fa-copy"></i> Copy</button><button class="btn small-btn ghost-btn" onclick="generatePainLetter()"><i class="fa-solid fa-rotate"></i> Regenerate</button>`;
            document.getElementById('action-bar').style.display = 'flex';

            document.getElementById('pain-output').innerHTML = `<div class="pain-output" id="pain-text" contenteditable="true">${result.letterHtml}</div><p style="text-align:center;font-size:0.8rem;color:var(--text-secondary);margin-top:1rem;font-style:italic;"><i class="fa-solid fa-brain"></i> ${result.whyItWorks}</p>`;
        }
        
    // Expose functions to global scope for onclick handlers
    window.generatePainLetter = generatePainLetter;
})();
    </script>

    <footer class="site-footer">
        <p>&copy; 2026 TailorMeSwiftly.com. This service is mostly free to use and supported by advertising.</p>
        <p><a href="terms.html">Terms & Conditions</a> | <a href="privacy.html">Privacy Policy</a> | <a href="security.html">Security Policy</a></p>
    </footer>
</body>

</html>
