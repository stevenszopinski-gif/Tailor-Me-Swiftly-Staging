<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://pagead2.googlesyndication.com https://www.googletagmanager.com https://esm.sh https://js.stripe.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https: blob:; connect-src 'self' https://*.supabase.co https://*.supabase.in wss://*.supabase.co https://pagead2.googlesyndication.com https://api.elevenlabs.io; frame-src https://js.stripe.com https://pagead2.googlesyndication.com;">
    <meta name="description" content="Practice salary negotiation with a voice-to-voice AI HR rep. Speak naturally and hear the HR rep respond in real-time.">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="TailorMeSwiftly">
    <meta property="og:url" content="https://tailormeswiftly.com/salary-negotiator.html">
    <meta property="og:image" content="https://tailormeswiftly.com/logo.png">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="https://tailormeswiftly.com/logo.png">
    <link rel="canonical" href="https://tailormeswiftly.com/salary-negotiator.html">
    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="apple-touch-icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="alternate" type="application/rss+xml" title="TailorMeSwiftly.com Release Notes" href="/feed.xml">
    <title>Salary Negotiator â€“ TailorMeSwiftly</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css?v=16">
    <link rel="stylesheet" href="templates.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7832382680038641" crossorigin="anonymous"></script>
    <style>
        .result-page { max-width: 700px; margin: 0 auto; padding: 1.5rem 1.5rem 4rem; }
        .chat-container { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1rem; min-height: 300px; }
        .chat-msg { max-width: 85%; padding: 1rem; border-radius: 16px; font-size: 0.9rem; line-height: 1.6; animation: fadeIn 0.3s ease-out; }
        .chat-msg.hr { align-self: flex-start; background: var(--glass-bg); border: 1px solid var(--panel-border); border-bottom-left-radius: 4px; }
        .chat-msg.user { align-self: flex-end; background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(52,211,153,0.1)); border: 1px solid rgba(16,185,129,0.3); border-bottom-right-radius: 4px; }
        .chat-msg.coach { align-self: center; background: rgba(99,102,241,0.08); border: 1px solid rgba(99,102,241,0.2); border-radius: 12px; font-size: 0.8rem; text-align: center; max-width: 95%; }
        .chat-msg .role { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.3rem; }
        .chat-msg.hr .role { color: #ef4444; }
        .chat-msg.user .role { color: #10b981; }
        .chat-msg.coach .role { color: #6366f1; }
        .voice-controls { display: flex; flex-direction: column; align-items: center; gap: 1rem; margin-top: 1rem; }
        .mic-btn { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--panel-border); background: var(--glass-bg); color: var(--text-primary); font-size: 1.8rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; }
        .mic-btn:hover { border-color: var(--primary-color); transform: scale(1.05); }
        .mic-btn.listening { border-color: #ef4444; background: rgba(239,68,68,0.1); animation: pulse 1.5s ease-in-out infinite; }
        .mic-btn.speaking { border-color: #22c55e; background: rgba(34,197,94,0.1); }
        .voice-status { font-size: 0.85rem; font-weight: 600; color: var(--text-secondary); min-height: 1.2em; }
        .voice-status.listening { color: #ef4444; }
        .voice-status.speaking { color: #22c55e; }
        .voice-status.processing { color: #f59e0b; }
        .mode-toggle { display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem; }
        .mode-btn { padding: 0.4rem 1rem; border: 1px solid var(--panel-border); border-radius: 999px; font-size: 0.82rem; cursor: pointer; background: none; color: var(--text-secondary); font-family: inherit; transition: all 0.2s; }
        .mode-btn.active { background: var(--primary-color); color: #fff; border-color: var(--primary-color); }
        .chat-input-bar { display: flex; gap: 0.5rem; }
        .chat-input-bar input { flex: 1; padding: 0.75rem 1rem; border: 1px solid var(--panel-border); border-radius: 12px; background: rgba(255,255,255,0.05); color: var(--text-primary); font-family: inherit; font-size: 0.9rem; }
        .chat-input-bar input:focus { outline: none; border-color: var(--primary-color); }
        .salary-setup { text-align: center; }
        .salary-setup input { padding: 0.5rem 1rem; border: 1px solid var(--panel-border); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--text-primary); font-family: inherit; font-size: 1rem; width: 150px; text-align: center; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0.3); } 50% { box-shadow: 0 0 0 15px rgba(239,68,68,0); } }
    </style>
</head>

<body>
    <a href="#main-content" class="skip-nav">Skip to main content</a>
    <div class="app-container" style="min-height: auto;">
        <header class="app-header" role="banner">
            <div class="logo">
                <a href="index.html" style="text-decoration:none;color:inherit;display:flex;align-items:center;gap:0.75rem;">
                    <div class="logo-icon"><i class="fa-solid fa-clipboard"></i></div>
                    <h1>TailorMeSwiftly.com</h1>
                </a>
            </div>
            <div id="product-switcher" class="product-switcher"></div>
            <div class="header-actions" style="display:flex;gap:1rem;align-items:center;">
                <div id="user-profile" style="display:none;flex-direction:column;align-items:center;gap:0.2rem;position:relative;">
                    <img id="user-avatar" aria-label="User menu" src="" alt="Avatar" style="width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid var(--primary-color);cursor:pointer;" onclick="document.getElementById('avatar-dropdown').classList.toggle('hidden')">
                    <span id="user-greeting" style="font-size:0.7rem;color:var(--text-secondary);white-space:nowrap;"></span>
                    <div id="avatar-dropdown" class="avatar-dropdown hidden">
                        <a href="account.html" class="dropdown-item" style="text-decoration:none;color:inherit;">
                            <i class="fa-solid fa-user-gear"></i> Account
                        </a>
                                                <a href="dashboard.html" class="dropdown-item" style="text-decoration:none;color:inherit;"><i class="fa-solid fa-compass"></i> Dashboard</a>
                        <a href="updates.html" class="dropdown-item" style="text-decoration:none;color:inherit;"><i class="fa-solid fa-bullhorn"></i> Release Notes</a>                        <button class="dropdown-item" id="logout-btn" aria-label="Sign out"><i class="fa-solid fa-arrow-right-from-bracket"></i> Sign Out</button>
                    </div>
                </div>
            </div>
        </header>
    </div>

    <div id="main-content" class="result-page">
        <div style="text-align:center;margin-bottom:1.5rem;">
            <a href="results.html" style="color:var(--text-secondary);text-decoration:none;font-size:0.85rem;"><i class="fa-solid fa-arrow-left"></i> Back to Results</a>
        </div>
        <h1 style="text-align:center;font-size:1.6rem;margin:0 0 0.5rem;"><i class="fa-solid fa-sack-dollar" style="color:#22c55e;margin-right:0.5rem;"></i>Salary Negotiator</h1>
        <p style="text-align:center;color:var(--text-secondary);margin-bottom:2rem;">Voice-to-voice negotiation practice with a stubborn AI HR rep</p>

        <div id="salary-setup" class="salary-setup">
            <p style="color:var(--text-secondary);margin-bottom:1rem;">What salary are you targeting?</p>
            <div style="display:flex;gap:1rem;justify-content:center;align-items:center;margin-bottom:1.5rem;flex-wrap:wrap;">
                <div>
                    <label style="font-size:0.8rem;color:var(--text-secondary);display:block;margin-bottom:0.3rem;">Your Target</label>
                    <input id="target-salary" type="text" placeholder="$120,000" value="">
                </div>
                <div>
                    <label style="font-size:0.8rem;color:var(--text-secondary);display:block;margin-bottom:0.3rem;">Their Likely Offer</label>
                    <input id="initial-offer" type="text" placeholder="$95,000" value="">
                </div>
            </div>
            <button class="btn primary-btn" onclick="startNegotiation()"><i class="fa-solid fa-microphone"></i> Start Voice Negotiation</button>
            <p style="font-size:0.78rem;color:var(--text-secondary);margin-top:0.75rem;">Uses your microphone for speech input and browser TTS for the HR rep's voice</p>
        </div>

        <div id="chat-area" style="display:none;">
            <div class="mode-toggle">
                <button class="mode-btn active" id="mode-voice" onclick="setMode('voice')"><i class="fa-solid fa-microphone"></i> Voice</button>
                <button class="mode-btn" id="mode-text" onclick="setMode('text')"><i class="fa-solid fa-keyboard"></i> Text</button>
            </div>
            <div class="chat-container" id="chat-container"></div>

            <!-- Voice mode controls -->
            <div class="voice-controls" id="voice-controls">
                <div class="voice-status" id="voice-status">Tap to speak</div>
                <button class="mic-btn" id="mic-btn" onclick="toggleListening()">
                    <i class="fa-solid fa-microphone"></i>
                </button>
                <p style="font-size:0.75rem;color:var(--text-secondary);margin:0;">Hold to speak, release to send</p>
            </div>

            <!-- Text mode controls -->
            <div class="chat-input-bar" id="text-controls" style="display:none;">
                <input id="chat-input" placeholder="Type your response..." onkeydown="if(event.key==='Enter')sendTextMessage()">
                <button class="btn primary-btn" onclick="sendTextMessage()" id="send-btn"><i class="fa-solid fa-paper-plane"></i></button>
            </div>

            <div style="text-align:center;margin-top:1rem;">
                <button class="btn small-btn ghost-btn" onclick="getCoachTip()"><i class="fa-solid fa-lightbulb"></i> Get Coach Tip</button>
                <button class="btn small-btn ghost-btn" onclick="endNegotiation()"><i class="fa-solid fa-flag-checkered"></i> End & Get Score</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.0"></script>
    <script src="brand-config.js"></script>
    <script src="auth.js?v=13"></script>
    <script src="components.js"></script>
    <script src="error-utils.js"></script>
    <script src="results.js?v=8"></script>
    <script>
        initResultTheme();
        initResultAuth();

        let chatHistory = [], targetSalary = '', initialOffer = '',
            recognition = null, isListening = false, currentMode = 'voice';

        (async function() {
        if (!(await guardToolAccess())) return;
        const outputs = loadOutputs();
        if (!outputs) { showSessionExpired(document.querySelector('.result-page')); return; }
        let isSpeaking = false;

        // Setup speech recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onresult = (event) => {
                let finalTranscript = '';
                let interimTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }
                if (interimTranscript) {
                    setVoiceStatus('listening', `"${interimTranscript}..."`);
                }
                if (finalTranscript) {
                    stopListening();
                    sendVoiceMessage(finalTranscript.trim());
                }
            };

            recognition.onerror = (e) => {
                if (e.error !== 'aborted') {
                    setVoiceStatus('', 'Could not hear you. Tap to try again.');
                }
                stopListening();
            };

            recognition.onend = () => {
                if (isListening) {
                    // Auto-restart if still in listening mode
                    try { recognition.start(); } catch(e) {}
                }
            };
        }

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('mode-voice').classList.toggle('active', mode === 'voice');
            document.getElementById('mode-text').classList.toggle('active', mode === 'text');
            document.getElementById('voice-controls').style.display = mode === 'voice' ? 'flex' : 'none';
            document.getElementById('text-controls').style.display = mode === 'text' ? 'flex' : 'none';
        }

        function setVoiceStatus(state, text) {
            const el = document.getElementById('voice-status');
            el.className = `voice-status ${state}`;
            el.textContent = text || '';
        }

        function speakText(text) {
            return new Promise((resolve) => {
                if (!('speechSynthesis' in window)) { resolve(); return; }

                // Cancel any ongoing speech
                speechSynthesis.cancel();
                isSpeaking = true;

                const micBtn = document.getElementById('mic-btn');
                micBtn.classList.add('speaking');
                micBtn.classList.remove('listening');
                setVoiceStatus('speaking', 'HR Rep is speaking...');

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 1.0;
                utterance.pitch = 0.9;

                // Try to find a good voice
                const voices = speechSynthesis.getVoices();
                const preferred = voices.find(v => v.name.includes('Daniel') || v.name.includes('Google UK English Male') || (v.lang === 'en-US' && v.name.includes('Male')));
                if (preferred) utterance.voice = preferred;

                utterance.onend = () => {
                    isSpeaking = false;
                    micBtn.classList.remove('speaking');
                    setVoiceStatus('', 'Tap to speak');
                    resolve();
                };
                utterance.onerror = () => {
                    isSpeaking = false;
                    micBtn.classList.remove('speaking');
                    resolve();
                };

                speechSynthesis.speak(utterance);
            });
        }

        function toggleListening() {
            if (isSpeaking) {
                speechSynthesis.cancel();
                isSpeaking = false;
                document.getElementById('mic-btn').classList.remove('speaking');
                setVoiceStatus('', 'Tap to speak');
                return;
            }
            if (isListening) {
                stopListening();
            } else {
                startListening();
            }
        }

        function startListening() {
            if (!recognition) {
                alert('Speech recognition is not supported in this browser. Please use Chrome or Edge.');
                setMode('text');
                return;
            }
            isListening = true;
            const micBtn = document.getElementById('mic-btn');
            micBtn.classList.add('listening');
            setVoiceStatus('listening', 'Listening...');
            try { recognition.start(); } catch(e) {}
        }

        function stopListening() {
            isListening = false;
            const micBtn = document.getElementById('mic-btn');
            micBtn.classList.remove('listening');
            try { recognition.stop(); } catch(e) {}
        }

        function addMessage(role, text) {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.className = `chat-msg ${role}`;
            const roleLabel = role === 'hr' ? 'HR Rep' : role === 'user' ? 'You' : 'Coach';
            div.innerHTML = `<div class="role">${roleLabel}</div>${text}`;
            container.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }

        async function startNegotiation() {
            targetSalary = document.getElementById('target-salary').value || '$120,000';
            initialOffer = document.getElementById('initial-offer').value || '$95,000';

            document.getElementById('salary-setup').style.display = 'none';
            document.getElementById('chat-area').style.display = 'block';

            // Load voices
            if ('speechSynthesis' in window) speechSynthesis.getVoices();

            addMessage('coach', `Negotiation starting. The HR rep will offer around <strong>${initialOffer}</strong>. Your goal: <strong>${targetSalary}</strong>. ${currentMode === 'voice' ? 'Tap the mic to speak.' : 'Type your responses.'}`);

            const systemMsg = `You are a stubborn but professional HR representative at ${outputs.targetCompany || 'a company'}. You're negotiating salary for the role described in the job description. Your initial offer is ${initialOffer}. You should:
- Start by presenting the offer enthusiastically
- Push back on counter-offers with budget constraints, market data, and company policy
- Be willing to negotiate on non-salary items (signing bonus, equity, PTO, remote work)
- Eventually concede slightly if the candidate makes strong arguments
- Be realistic and professional, not cartoonish
- Keep responses to 2-4 sentences

Job title context from JD: ${outputs.jobText?.substring(0, 500) || 'Senior role'}`;

            chatHistory = [{ role: 'user', parts: [{ text: systemMsg }] }];

            await getHRResponse('Start the negotiation by presenting the initial offer.', true);
        }

        async function getHRResponse(userText, speak = true) {
            chatHistory.push({ role: 'user', parts: [{ text: userText }] });
            setVoiceStatus('processing', 'HR Rep is thinking...');

            try {
                const { data, error } = await supabaseClient.functions.invoke('gemini-proxy', {
                    body: {
                        model: 'gemini-3-flash-preview',
                        systemInstruction: { parts: [{ text: `You are a stubborn HR representative negotiating salary. The initial offer is ${initialOffer}. Keep responses to 2-4 sentences. Be professional but firm. Push back with budget constraints and market data.` }] },
                        contents: chatHistory,
                        generationConfig: { temperature: 0.8 }
                    }
                });

                if (error) throw new Error(error.message);
                const response = data.candidates[0].content.parts[0].text.trim();
                chatHistory.push({ role: 'model', parts: [{ text: response }] });
                addMessage('hr', response);

                // Speak the response
                if (speak && currentMode === 'voice') {
                    await speakText(response);
                }
            } catch (e) {
                addMessage('coach', `Connection error: ${e.message}. Try again.`);
                setVoiceStatus('', 'Tap to speak');
            }
        }

        async function sendVoiceMessage(text) {
            if (!text) return;
            addMessage('user', text);
            setVoiceStatus('processing', 'HR Rep is thinking...');
            await getHRResponse(text, true);
        }

        async function sendTextMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;

            input.value = '';
            addMessage('user', text);

            const sendBtn = document.getElementById('send-btn');
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';

            await getHRResponse(text, currentMode === 'voice');

            sendBtn.disabled = false;
            sendBtn.innerHTML = '<i class="fa-solid fa-paper-plane"></i>';
            input.focus();
        }

        async function getCoachTip() {
            const lastHR = chatHistory.filter(m => m.role === 'model').pop();
            if (!lastHR) return;

            try {
                const { data, error } = await supabaseClient.functions.invoke('gemini-proxy', {
                    body: {
                        model: 'gemini-3-flash-preview',
                        systemInstruction: { parts: [{ text: `You are a salary negotiation coach. The candidate is targeting ${targetSalary} and was offered ${initialOffer}. Give a brief, specific tip (1-2 sentences) on how to respond to the HR rep's last message. Be tactical.` }] },
                        contents: [{ parts: [{ text: `HR rep just said: "${lastHR.parts[0].text}"\n\nWhat should I say next?` }] }],
                        generationConfig: { temperature: 0.7 }
                    }
                });

                if (error) throw new Error(error.message);
                const tip = data.candidates[0].content.parts[0].text.trim();
                addMessage('coach', `<i class="fa-solid fa-lightbulb" style="color:#6366f1;"></i> ${tip}`);
            } catch (e) {
                addMessage('coach', 'Could not get tip. Try again.');
            }
        }

        async function endNegotiation() {
            // Stop any ongoing speech/listening
            if (isSpeaking) speechSynthesis.cancel();
            stopListening();

            addMessage('coach', '<i class="fa-solid fa-spinner fa-spin"></i> Analyzing your negotiation...');

            const convo = chatHistory.map(m => `${m.role === 'model' ? 'HR' : 'Candidate'}: ${m.parts[0].text}`).join('\n');

            try {
                const { data, error } = await supabaseClient.functions.invoke('gemini-proxy', {
                    body: {
                        model: 'gemini-3-flash-preview',
                        systemInstruction: { parts: [{ text: `You are a salary negotiation expert. Score this negotiation and provide feedback. Initial offer: ${initialOffer}. Target: ${targetSalary}. Provide: 1) A score out of 10, 2) What they did well, 3) What they should improve, 4) Estimate of what salary they'd likely land at. Keep it concise.` }] },
                        contents: [{ parts: [{ text: convo }] }],
                        generationConfig: { temperature: 0.5 }
                    }
                });

                if (error) throw new Error(error.message);
                const feedback = data.candidates[0].content.parts[0].text.trim();
                const container = document.getElementById('chat-container');
                container.lastChild.remove();
                addMessage('coach', `<strong><i class="fa-solid fa-flag-checkered"></i> Negotiation Complete!</strong><br><br>${feedback.replace(/\n/g, '<br>')}`);

                document.getElementById('voice-controls').style.display = 'none';
                document.getElementById('text-controls').style.display = 'none';
                document.querySelector('.mode-toggle').style.display = 'none';
            } catch (e) {
                addMessage('coach', `Could not analyze: ${e.message}`);
            }
        }
        
    // Expose functions to global scope for onclick handlers
    window.startNegotiation = startNegotiation;
    window.setMode = setMode;
    window.toggleListening = toggleListening;
    window.sendTextMessage = sendTextMessage;
    window.getCoachTip = getCoachTip;
    window.endNegotiation = endNegotiation;
})();
    </script>

    <footer class="site-footer" role="contentinfo">
        <p>&copy; 2026 TailorMeSwiftly.com. This service is mostly free to use and supported by advertising.</p>
        <p><a href="terms.html">Terms & Conditions</a> | <a href="privacy.html">Privacy Policy</a> | <a href="security.html">Security Policy</a></p>
    </footer>
</body>

</html>
